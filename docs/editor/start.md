---
layout: page
title: 搞起
permalink: /docs/editor/start/
---

「松饼人物编辑器：从入门到欧耶」系列教程（一）

## 编辑器是干什么的

- 创建和编辑「原创角色」
    - 自由指定名字、头像、以及技能
- 编辑好的角色存在本地
    - 所以就算头像 R-18 也不会被查水表
    - 将来是否做成分享原创角色的平台 -> 待定

<br />

## 当前状态

目前人物编辑器处于开发阶段，有些系统自带的角色无法用编辑器做出来。
完整版的编辑器预计可以做出所有的系统自带角色。

[人物编辑范例](/docs/editor/examples/)
页面列举了目前可以通过编辑器轻松实现的自带角色。

原创角色的能力暂时无法在未来视中发动。

<br />

## 关于 Lua

技能的编辑方式是「Lua 脚本」。
Lua 是一门简单、简单、简单、简单的编程语言，
无论是萝莉还是大叔，攻还是受，看一眼就能学会，无需特别的专业背景。

本系列教程假定读者完全不会编程 ——
讲编辑器的同时，也会根据需要顺带讲一些编程的基础。
学习松饼编辑器的同时也会顺便了解到一些编程的知识。

<br />

## 第一个栗子

打开人物编辑器，点击「新建人物」，
文件名、人物名、头像都随便弄一个。

![新建]({{ "/assets/editor_new.png" | absolute_url }})

文件名只能由字母、数字、下划线`_`组成。
如果输入的文件名已存在，则会发生覆盖。
人物名可以包含任意字符，而且重复了也没关系。

填好文件名和人物名后，在下面的大框内尬入以下代码：

```lua
print("Vanishmennt this world!")
```

点击「保存」，我们第一个原创角色就大功告成了。
赶紧用三狗战测试一下x

![运行]({{ "/assets/editor_first_run.png" | absolute_url }})

你会发现，一桌开始时，
中间会蹦出一句「Vanishment this world!」，中二爆表。
然后……就没有然后了x

虽然技能很简单，但它也是一个完整的人物 ——
有名字、有头像、而且有一段完整的 Lua 代码。

<br />

## 调试

上面的例子讲的是一切顺利的理想情况。
在现实中，很有可能看不到「Vanishment this world!」，
而是得到一些奇怪的输出，比如下图：

![运行错误]({{ "/assets/editor_error.png" | absolute_url }})

出现这种情况，说明你的代码有问题，比如这样：

```lua
print(Vanishmennt this world!)
```
这样：
```lua
Print("Vanishmennt this world!")
```
这样：

```lua
print(“Vanishmennt this world!”)
```
或者这样：
```lua
print("Vanishmennt this world!"
```

有的时候，你可能发现从教程里照抄的代码也会出错。
这个时候，不要怀疑范例有错 —— 肯定是你抄错了。

代码出错是个很正常的现象，
就好比打麻将吃四一样 ——
虽然一开始会觉得很痛苦，但适应了也就没事了。
遇到错误时，只要像死神小学生一样去推理分析，
总会找到错在哪里。

<br />

## 代码详解

回顾我们刚写的代码：

```lua
print("Vanishmennt this world!")
```

这段代码以`"Vanishment this world!"`作为「参数」，
「调用」了一个名叫`print`的「函数」。

- 一个「函数」就是一件事情。
  「调用」一个函数，就是命令机器去做一件事情。
  这里我们调用了`print`函数，让程序输出了一行文字。
- 所谓「参数」，就是做一件事情所需的材料。
  既然我们让`print`去输出文字，`print`就需要知道具体要输出什么文字。
  于是我们就把`"Vanishment this world"`这个参数传了进去。

<br />

## 第二个栗子

新建人物，输入以下代码并保存。

```lua
function ondraw()
  print("哇！")
end
```

三狗战测试，发现每当有人摸牌时都会输出一次「哇！!」。
这意味着，我们成功地实现了一个完整的摸牌挂 ——
每次摸牌时，这个挂都会生效 —— 虽然只是打印一行字。

不过多数情况下，自己的进张和他家的进张需要区别对待 ——
比如给自己塞有效牌，给他家塞铳牌什么的。
所以我们继续改进代码，让程序区另对待自己和他家的摸牌 ——
自己摸牌时输出「哇！」，而他家摸牌时输出「emmmm...」。

```lua
function ondraw()
  if who == self then
    print("哇！")
  else
    print("emmm...")
  end
end
```

三狗战测试，发现程序表现和预期一致，一脸计划通。

虽然这个挂仍然没什么卵用，但好歹是个完整的进张挂，
并且可以区别对待自己和他家的摸牌。

<br />

## 代码详解

回顾第一段代码：

```lua
function ondraw()
  print("哇！")
end
```

这段代码「定义」了一个名叫`ondraw`的函数。
`ondraw`函数做了一件事情 —— 输出`"waaah!!"`。

函数的「定义」会在将来的课程中详细讲解。
现在我们只需要知道以下两点：

- 被包围在`function ondraw()`和`end`之间的代码只会在摸牌时被执行
- 完全裸露在外的代码只会在一桌开始时被执行

定义摸牌挂的函数名必须叫`ondraw`，所有字母都小写。


再看第二段代码：

```lua
function ondraw()
  if who == self then
    print("哇！")
  else
    print("emmm...")
  end
end
```

多出来的东西叫「`if`语句」。
`if`语句的作用，是让程序根据某个条件的不同，
而去执行不同的代码。
条件要写在`if`和`then`之间。
条件被满足时，执行`then`和`else`之间的代码;
条件未被满足时，执行`else`和`end`之间的代码。
中间这 5 行代码的意思是：
「如果摸牌人等于自己，则输出`"waaah!!"`，否则输出`"emmm..."`」。

我们再详解一下这里的`who == self`是什么鬼。
在`ondraw`函数定义的内部，`who`代表当前摸牌人。
如果是自己摸牌，那么执行这段代码时，`who`就是自己；
如果是下家，`who`就是下家，以此类推。
而`self`则始终代表自己。中间的`==`是等号。

在 Lua 中，两个`=`组成的`==`才是等号，用一个`=`是不行的。
很多编程语言都是这个尿性 —— 符号的意义和我们日常生活中的不同。
他们这么设计，并不是在捉弄你，背后一般都有着各种值得同情的原因。
掌握了一门语言的全貌后，自然就理解这些设计的成因了。

<br />

## 缩进

每行代码前面的空格不是必须的。
也就是说，我们刚刚看过的代码，写成这样也可以正常执行：

```lua
function ondraw()
if who == self then
print("哇！")
else
print("emmm...")
end
end
```

但去掉空格以后，代码一下子变**丑**了。
有空格时，我们一眼就能看出，`if`语句块是套在`ondraw`函数定义里的，
而两个`print`语句则是分别套在`then`块和`else`块里的 ——
包含关系一目了然。
然而，去掉空格以后，
我们必须仔细读，并理解这三行代码的内容，才能看出这个嵌套关系。
这种用于体现代码嵌套关系的空格，叫作「缩进」。

代码越长，缩进就越重要。
代码的颜值并不仅仅用来观赏的 —— 它会左右开发的效率。
越是漂亮的代码，理解起来就越容易，
不但可以让别人改起来方便，也可以让自己改起来方便。
反过来，代码写得丑，不妥善处理缩进，会被人吊起来啪啪啪的。

因此，尽管缩进不影响代码的执行结果，
该加缩进的地方也都必须加上缩进。
被包含的代码块始终要处于包含它的代码块的右侧。

一格缩进的具体大小因人而异，
但在松饼人物编辑器内，我们统一使用「两个空格」。
按下 Tab 键，光标所在行会向右窜两个空格；
按下 Shift + Tab 键则向左窜两个空格。

<br />

## 代码编辑器

松饼自带的代码编辑器是轻量级的，设计目标是「能用」，而非「好用」。
如果觉得这个编辑器不够用，可以使用其它软件。
代码文件的存放位置为：

- Windows: `C:\Users\用户名\AppData\Local\mjpancake\edit`
- Linux: `~/.config/mjpancake/edit`
- macOS: `~/Library/Preferences/mjpancake/edit`
- Android/iOS: 手机写代码还要什么自行车x

<br />

## 练习题

1. 新建一个人物，在一桌开始时输出「呵呵」，在每次有人摸牌时输出「哈哈」。
2. 修改第 1 题中创建的人物，在他家摸牌时输出「嘿嘿嘿」，其余的不变。
3. 有人丢给你一段没有缩进的代码，你会怎么做？

每一讲的习题答案都在下一讲的开头。

下一讲：[数据类型](/docs/editor/var/)

